{"ast":null,"code":"/**\n * Scoring Engine for Swing Trade Analyzer\n * 75-point scoring system based on Minervini SEPA + CAN SLIM\n * \n * v2.0: Enhanced fundamental scoring with Defeat Beta data\n * v2.1: Fixed API structure - clean consumer-facing return object (Day 18)\n * \n * Scoring Breakdown:\n * - Technical: 40 points\n * - Fundamental: 20 points (ENHANCED)\n * - Sentiment: 10 points (placeholder)\n * - Risk/Macro: 5 points\n */\n\nimport { calculateSMA, calculateEMA, calculateATR } from './technicalIndicators';\nimport { calculateRelativeStrength } from './rsCalculator';\n\n/**\n * Calculate all technical indicators from price data\n */\nfunction getIndicators(prices, volumes) {\n  if (!prices || prices.length < 200) {\n    return null;\n  }\n  return {\n    sma50: calculateSMA(prices, 50),\n    sma200: calculateSMA(prices, 200),\n    ema8: calculateEMA(prices, 8),\n    ema21: calculateEMA(prices, 21),\n    atr: calculateATR(prices, 14),\n    rsi: null,\n    // RSI calculation not available in technicalIndicators.js yet\n    avgVolume50: volumes.slice(-50).reduce((a, b) => a + b, 0) / 50\n  };\n}\n\n/**\n * Calculate Technical Analysis Score (40 points)\n */\nfunction calculateTechnicalScore(stockData, spyData) {\n  const prices = stockData.priceHistory.map(d => d.close);\n  const volumes = stockData.priceHistory.map(d => d.volume);\n  if (prices.length < 50) {\n    return {\n      score: 0,\n      maxScore: 40,\n      details: {},\n      error: 'Insufficient price data'\n    };\n  }\n  const indicators = getIndicators(prices, volumes);\n  const currentPrice = prices[prices.length - 1];\n  let scores = {\n    trendStructure: 0,\n    shortTermTrend: 0,\n    volume: 0,\n    rs: 0\n  };\n\n  // 1. Trend Structure (15 points): Price > 50 SMA > 200 SMA\n  if (indicators.sma50 && indicators.sma200) {\n    if (currentPrice > indicators.sma50 && indicators.sma50 > indicators.sma200) {\n      scores.trendStructure = 15; // Perfect Stage 2 uptrend\n    } else if (currentPrice > indicators.sma200) {\n      scores.trendStructure = 5; // Above 200 SMA but not ideal structure\n    }\n  }\n\n  // 2. Short-term Trend (10 points): Price > 8 EMA > 21 EMA\n  if (indicators.ema8 && indicators.ema21) {\n    if (currentPrice > indicators.ema8 && indicators.ema8 > indicators.ema21) {\n      scores.shortTermTrend = 10; // Strong short-term momentum\n    } else if (currentPrice > indicators.ema21) {\n      scores.shortTermTrend = 3; // Above 21 EMA\n    }\n  }\n\n  // 3. Volume (5 points): Recent volume vs 50-day average\n  if (indicators.avgVolume50) {\n    const recentVolume = volumes.slice(-5).reduce((a, b) => a + b, 0) / 5;\n    const volumeRatio = recentVolume / indicators.avgVolume50;\n    if (volumeRatio >= 1.5) {\n      scores.volume = 5; // High volume interest\n    } else if (volumeRatio >= 1.0) {\n      scores.volume = 2; // Normal volume\n    }\n  }\n\n  // 4. Relative Strength (10 points)\n  const rsData = calculateRelativeStrength(stockData, spyData);\n  if (rsData && rsData.rs52Week) {\n    if (rsData.rs52Week >= 1.5) {\n      scores.rs = 10; // Strong outperformance\n    } else if (rsData.rs52Week >= 1.2) {\n      scores.rs = 7; // Good outperformance\n    } else if (rsData.rs52Week >= 1.0) {\n      scores.rs = 4; // Slight outperformance\n    } else if (rsData.rs52Week >= 0.8) {\n      scores.rs = 1; // Slight underperformance\n    }\n  }\n  const totalScore = scores.trendStructure + scores.shortTermTrend + scores.volume + scores.rs;\n  return {\n    score: totalScore,\n    maxScore: 40,\n    details: {\n      trendStructure: {\n        score: scores.trendStructure,\n        max: 15\n      },\n      shortTermTrend: {\n        score: scores.shortTermTrend,\n        max: 10\n      },\n      volume: {\n        score: scores.volume,\n        max: 5\n      },\n      relativeStrength: {\n        score: scores.rs,\n        max: 10\n      }\n    },\n    indicators: indicators,\n    rsData: rsData\n  };\n}\n\n/**\n * Calculate Fundamental Score (20 points)\n * ENHANCED with Defeat Beta data (ROE, ROIC, EPS Growth, etc.)\n */\nfunction calculateFundamentalScore(fundamentals) {\n  let scores = {\n    epsGrowth: 0,\n    revenueGrowth: 0,\n    roe: 0,\n    debtToEquity: 0,\n    forwardPe: 0\n  };\n  let dataSource = (fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.enrichedSource) || (fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.source) || 'unknown';\n  let dataQuality = 'limited';\n\n  // Check if we have enriched data from Defeat Beta\n  if (fundamentals !== null && fundamentals !== void 0 && fundamentals.enriched || (fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.source) === 'defeatbeta') {\n    dataQuality = 'rich';\n  }\n\n  // 1. EPS Growth (6 points)\n  // Target: >25% YoY = 6pts, 15-25% = 4pts, 10-15% = 2pts\n  const epsGrowth = fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.epsGrowth;\n  if (epsGrowth !== null && epsGrowth !== undefined && epsGrowth !== 0) {\n    if (epsGrowth >= 25) {\n      scores.epsGrowth = 6;\n    } else if (epsGrowth >= 15) {\n      scores.epsGrowth = 4;\n    } else if (epsGrowth >= 10) {\n      scores.epsGrowth = 2;\n    } else if (epsGrowth > 0) {\n      scores.epsGrowth = 1;\n    }\n  }\n\n  // 2. Revenue Growth (5 points)\n  // Target: >20% = 5pts, 10-20% = 3pts, 5-10% = 1pt\n  const revenueGrowth = fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.revenueGrowth;\n  if (revenueGrowth !== null && revenueGrowth !== undefined && revenueGrowth !== 0) {\n    if (revenueGrowth >= 20) {\n      scores.revenueGrowth = 5;\n    } else if (revenueGrowth >= 10) {\n      scores.revenueGrowth = 3;\n    } else if (revenueGrowth >= 5) {\n      scores.revenueGrowth = 1;\n    }\n  }\n\n  // 3. ROE (4 points)\n  // Target: >15% = 4pts, 10-15% = 2pts\n  const roe = fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.roe;\n  if (roe !== null && roe !== undefined && roe !== 0) {\n    if (roe >= 15) {\n      scores.roe = 4;\n    } else if (roe >= 10) {\n      scores.roe = 2;\n    } else if (roe > 0) {\n      scores.roe = 1;\n    }\n  }\n\n  // 4. Debt/Equity (3 points)\n  // Target: <1.0 = 3pts, 1.0-1.5 = 1pt\n  const debtToEquity = fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.debtToEquity;\n  if (debtToEquity !== null && debtToEquity !== undefined) {\n    if (debtToEquity < 0.5) {\n      scores.debtToEquity = 3; // Very low debt\n    } else if (debtToEquity < 1.0) {\n      scores.debtToEquity = 2;\n    } else if (debtToEquity < 1.5) {\n      scores.debtToEquity = 1;\n    }\n  }\n\n  // 5. Forward P/E (2 points)\n  // Target: <20 = 2pts, 20-25 = 1pt (reasonable valuation)\n  const forwardPe = fundamentals === null || fundamentals === void 0 ? void 0 : fundamentals.forwardPe;\n  if (forwardPe !== null && forwardPe !== undefined && forwardPe > 0) {\n    if (forwardPe < 20) {\n      scores.forwardPe = 2;\n    } else if (forwardPe < 25) {\n      scores.forwardPe = 1;\n    }\n  }\n  const totalScore = scores.epsGrowth + scores.revenueGrowth + scores.roe + scores.debtToEquity + scores.forwardPe;\n  return {\n    score: totalScore,\n    maxScore: 20,\n    details: {\n      epsGrowth: {\n        score: scores.epsGrowth,\n        max: 6,\n        value: epsGrowth\n      },\n      revenueGrowth: {\n        score: scores.revenueGrowth,\n        max: 5,\n        value: revenueGrowth\n      },\n      roe: {\n        score: scores.roe,\n        max: 4,\n        value: roe\n      },\n      debtToEquity: {\n        score: scores.debtToEquity,\n        max: 3,\n        value: debtToEquity\n      },\n      forwardPe: {\n        score: scores.forwardPe,\n        max: 2,\n        value: forwardPe\n      }\n    },\n    dataSource: dataSource,\n    dataQuality: dataQuality\n  };\n}\n\n/**\n * Calculate Sentiment Score (10 points)\n * Placeholder - real sentiment analysis in v2.0\n */\nfunction calculateSentimentScore() {\n  // TODO: Implement real sentiment analysis\n  // For now, return neutral score\n  return {\n    score: 5,\n    maxScore: 10,\n    details: {\n      newsScore: {\n        score: 5,\n        max: 10\n      }\n    },\n    note: 'Placeholder - real sentiment coming in v2.0'\n  };\n}\n\n/**\n * Calculate Risk/Macro Score (5 points)\n */\nfunction calculateRiskScore(spyData, vixData) {\n  let scores = {\n    vix: 0,\n    spyRegime: 0,\n    breadth: 0\n  };\n\n  // 1. VIX Level (2 points)\n  const vix = vixData === null || vixData === void 0 ? void 0 : vixData.current;\n  if (vix !== null && vix !== undefined) {\n    if (vix < 15) {\n      scores.vix = 2; // Low volatility - favorable\n    } else if (vix < 20) {\n      scores.vix = 1; // Normal volatility\n    }\n    // VIX > 20 = 0 points (elevated risk)\n  }\n\n  // 2. S&P 500 Regime (2 points)\n  if (spyData !== null && spyData !== void 0 && spyData.aboveSma200) {\n    scores.spyRegime = 2; // Bullish market regime\n  }\n\n  // 3. Market Breadth (1 point) - placeholder\n  // Would need % of stocks above 50 SMA\n  scores.breadth = 1; // Default to neutral\n\n  const totalScore = scores.vix + scores.spyRegime + scores.breadth;\n  return {\n    score: totalScore,\n    maxScore: 5,\n    details: {\n      vix: {\n        score: scores.vix,\n        max: 2,\n        value: vix\n      },\n      spyRegime: {\n        score: scores.spyRegime,\n        max: 2,\n        aboveSma200: spyData === null || spyData === void 0 ? void 0 : spyData.aboveSma200\n      },\n      breadth: {\n        score: scores.breadth,\n        max: 1\n      }\n    }\n  };\n}\n\n/**\n * Check Quality Gates (Auto-AVOID triggers)\n */\nfunction checkQualityGates(stockData, spyData, technicalResult) {\n  const gates = [];\n  const rsData = technicalResult === null || technicalResult === void 0 ? void 0 : technicalResult.rsData;\n  const indicators = technicalResult === null || technicalResult === void 0 ? void 0 : technicalResult.indicators;\n  const prices = stockData.priceHistory.map(d => d.close);\n  const currentPrice = prices[prices.length - 1];\n\n  // 1. RS below 0.8 (significant underperformance)\n  if (rsData !== null && rsData !== void 0 && rsData.rs52Week && rsData.rs52Week < 0.8) {\n    gates.push({\n      name: 'RS Below Threshold',\n      value: rsData.rs52Week.toFixed(2),\n      threshold: '< 0.8',\n      critical: true\n    });\n  }\n\n  // 2. Stock below 200 SMA (downtrend)\n  if (indicators !== null && indicators !== void 0 && indicators.sma200 && currentPrice < indicators.sma200) {\n    gates.push({\n      name: 'Below 200 SMA',\n      value: `$${currentPrice.toFixed(2)}`,\n      threshold: `> $${indicators.sma200.toFixed(2)}`,\n      critical: true\n    });\n  }\n\n  // 3. Average daily volume < $10M (illiquid)\n  const avgVolume = stockData.avgVolume || 0;\n  const avgDollarVolume = avgVolume * currentPrice;\n  if (avgDollarVolume < 10000000) {\n    gates.push({\n      name: 'Low Liquidity',\n      value: `$${(avgDollarVolume / 1000000).toFixed(1)}M`,\n      threshold: '> $10M',\n      critical: true\n    });\n  }\n\n  // Count critical failures\n  const criticalFails = gates.filter(g => g.critical).length;\n  return {\n    passed: criticalFails === 0,\n    gates: gates,\n    criticalFails: criticalFails\n  };\n}\n\n/**\n * Determine Verdict based on score and quality gates\n */\nfunction determineVerdict(totalScore, qualityGates, rsData) {\n  // Auto-AVOID conditions\n  if (qualityGates.criticalFails >= 2) {\n    return {\n      verdict: 'AVOID',\n      reason: `${qualityGates.criticalFails} critical failures`,\n      color: 'red'\n    };\n  }\n  if (rsData !== null && rsData !== void 0 && rsData.rs52Week && rsData.rs52Week < 0.8) {\n    return {\n      verdict: 'AVOID',\n      reason: 'RS significantly below market',\n      color: 'red'\n    };\n  }\n\n  // Score-based verdict\n  if (totalScore >= 60 && qualityGates.criticalFails === 0) {\n    // Additional check: RS must be >= 1.0 for BUY\n    if (rsData !== null && rsData !== void 0 && rsData.rs52Week && rsData.rs52Week >= 1.0) {\n      return {\n        verdict: 'BUY',\n        reason: `Strong score (${totalScore}/75) with good RS`,\n        color: 'green'\n      };\n    } else {\n      return {\n        verdict: 'HOLD',\n        reason: 'Good score but RS below 1.0',\n        color: 'yellow'\n      };\n    }\n  }\n  if (totalScore >= 40) {\n    return {\n      verdict: 'HOLD',\n      reason: `Moderate score (${totalScore}/75)`,\n      color: 'yellow'\n    };\n  }\n  return {\n    verdict: 'AVOID',\n    reason: `Low score (${totalScore}/75)`,\n    color: 'red'\n  };\n}\n\n/**\n * Main scoring function\n * Calculates complete analysis for a stock\n * \n * v2.1: Returns a clean, consumer-facing API structure\n */\nexport function calculateScore(stockData, spyData, vixData) {\n  // Calculate individual scores\n  const technicalAnalysis = calculateTechnicalScore(stockData, spyData);\n  const fundamentalAnalysis = calculateFundamentalScore(stockData.fundamentals);\n  const sentimentAnalysis = calculateSentimentScore();\n  const riskAnalysis = calculateRiskScore(spyData, vixData);\n\n  // Total score\n  const totalScore = technicalAnalysis.score + fundamentalAnalysis.score + sentimentAnalysis.score + riskAnalysis.score;\n\n  // Quality gates\n  const qualityGates = checkQualityGates(stockData, spyData, technicalAnalysis);\n\n  // Verdict\n  const verdict = determineVerdict(totalScore, qualityGates, technicalAnalysis.rsData);\n\n  // Get RS data for clean API\n  const rsData = technicalAnalysis.rsData || {};\n\n  // Calculate % from 52-week high\n  const fiftyTwoWeekHigh = stockData.fiftyTwoWeekHigh;\n  const fiftyTwoWeekLow = stockData.fiftyTwoWeekLow;\n  const currentPrice = stockData.currentPrice;\n  const pctFromHigh = fiftyTwoWeekHigh ? (currentPrice - fiftyTwoWeekHigh) / fiftyTwoWeekHigh * 100 : null;\n\n  // Debug logging\n  console.log('=== SCORING ENGINE DEBUG ===');\n  console.log('Stock:', stockData.ticker);\n  console.log('Technical Score:', technicalAnalysis.score, '/', technicalAnalysis.maxScore);\n  console.log('Technical Details:', technicalAnalysis.details);\n  console.log('Fundamental Score:', fundamentalAnalysis.score, '/', fundamentalAnalysis.maxScore);\n  console.log('Fundamental Details:', fundamentalAnalysis.details);\n  console.log('Fundamental Data Source:', fundamentalAnalysis.dataSource);\n  console.log('Fundamental Data Quality:', fundamentalAnalysis.dataQuality);\n  console.log('Sentiment Score:', sentimentAnalysis.score, '/', sentimentAnalysis.maxScore);\n  console.log('Risk Score:', riskAnalysis.score, '/', riskAnalysis.maxScore);\n  console.log('Total Score:', totalScore, '/ 75');\n  console.log('Quality Gates:', qualityGates);\n  console.log('Verdict:', verdict);\n  console.log('============================');\n\n  // =========================================================\n  // CLEAN API RETURN STRUCTURE (v2.1)\n  // UI can consume this directly without knowing internals\n  // =========================================================\n  return {\n    // Basic info\n    ticker: stockData.ticker,\n    name: stockData.name,\n    sector: stockData.sector,\n    industry: stockData.industry,\n    // Price data (for UI display)\n    currentPrice: currentPrice,\n    fiftyTwoWeekHigh: fiftyTwoWeekHigh,\n    fiftyTwoWeekLow: fiftyTwoWeekLow,\n    pctFromHigh: pctFromHigh,\n    // Scores - FLAT structure for easy UI consumption\n    totalScore: totalScore,\n    maxScore: 75,\n    scores: {\n      technical: technicalAnalysis.score,\n      fundamental: fundamentalAnalysis.score,\n      sentiment: sentimentAnalysis.score,\n      risk: riskAnalysis.score\n    },\n    // Verdict\n    verdict: verdict,\n    qualityGates: qualityGates,\n    // RS Data - Normalized field names for UI\n    rsData: {\n      rsRatio: rsData.rs52Week,\n      // UI expects rsRatio\n      rs52Week: rsData.rs52Week,\n      rs13Week: rsData.rs13Week,\n      rsRating: rsData.rsRating,\n      rsTrend: rsData.rsTrend,\n      stock52wReturn: rsData.stockReturn52w,\n      // UI expects stock52wReturn\n      spy52wReturn: rsData.spyReturn52w,\n      // UI expects spy52wReturn\n      interpretation: rsData.interpretation,\n      passesQualityGate: rsData.passesQualityGate\n    },\n    // Technical indicators\n    indicators: technicalAnalysis.indicators,\n    // Detailed breakdown (for debugging/advanced UI)\n    breakdown: {\n      technical: technicalAnalysis,\n      fundamental: fundamentalAnalysis,\n      sentiment: sentimentAnalysis,\n      risk: riskAnalysis\n    },\n    // Metadata\n    timestamp: new Date().toISOString()\n  };\n}","map":{"version":3,"names":["calculateSMA","calculateEMA","calculateATR","calculateRelativeStrength","getIndicators","prices","volumes","length","sma50","sma200","ema8","ema21","atr","rsi","avgVolume50","slice","reduce","a","b","calculateTechnicalScore","stockData","spyData","priceHistory","map","d","close","volume","score","maxScore","details","error","indicators","currentPrice","scores","trendStructure","shortTermTrend","rs","recentVolume","volumeRatio","rsData","rs52Week","totalScore","max","relativeStrength","calculateFundamentalScore","fundamentals","epsGrowth","revenueGrowth","roe","debtToEquity","forwardPe","dataSource","enrichedSource","source","dataQuality","enriched","undefined","value","calculateSentimentScore","newsScore","note","calculateRiskScore","vixData","vix","spyRegime","breadth","current","aboveSma200","checkQualityGates","technicalResult","gates","push","name","toFixed","threshold","critical","avgVolume","avgDollarVolume","criticalFails","filter","g","passed","determineVerdict","qualityGates","verdict","reason","color","calculateScore","technicalAnalysis","fundamentalAnalysis","sentimentAnalysis","riskAnalysis","fiftyTwoWeekHigh","fiftyTwoWeekLow","pctFromHigh","console","log","ticker","sector","industry","technical","fundamental","sentiment","risk","rsRatio","rs13Week","rsRating","rsTrend","stock52wReturn","stockReturn52w","spy52wReturn","spyReturn52w","interpretation","passesQualityGate","breakdown","timestamp","Date","toISOString"],"sources":["/Users/balajik/projects/swing-trade-analyzer/frontend/src/utils/scoringEngine.js"],"sourcesContent":["/**\n * Scoring Engine for Swing Trade Analyzer\n * 75-point scoring system based on Minervini SEPA + CAN SLIM\n * \n * v2.0: Enhanced fundamental scoring with Defeat Beta data\n * v2.1: Fixed API structure - clean consumer-facing return object (Day 18)\n * \n * Scoring Breakdown:\n * - Technical: 40 points\n * - Fundamental: 20 points (ENHANCED)\n * - Sentiment: 10 points (placeholder)\n * - Risk/Macro: 5 points\n */\n\nimport { calculateSMA, calculateEMA, calculateATR } from './technicalIndicators';\nimport { calculateRelativeStrength } from './rsCalculator';\n\n/**\n * Calculate all technical indicators from price data\n */\nfunction getIndicators(prices, volumes) {\n  if (!prices || prices.length < 200) {\n    return null;\n  }\n  \n  return {\n    sma50: calculateSMA(prices, 50),\n    sma200: calculateSMA(prices, 200),\n    ema8: calculateEMA(prices, 8),\n    ema21: calculateEMA(prices, 21),\n    atr: calculateATR(prices, 14),\n    rsi: null, // RSI calculation not available in technicalIndicators.js yet\n    avgVolume50: volumes.slice(-50).reduce((a, b) => a + b, 0) / 50\n  };\n}\n\n/**\n * Calculate Technical Analysis Score (40 points)\n */\nfunction calculateTechnicalScore(stockData, spyData) {\n  const prices = stockData.priceHistory.map(d => d.close);\n  const volumes = stockData.priceHistory.map(d => d.volume);\n  \n  if (prices.length < 50) {\n    return { score: 0, maxScore: 40, details: {}, error: 'Insufficient price data' };\n  }\n  \n  const indicators = getIndicators(prices, volumes);\n  const currentPrice = prices[prices.length - 1];\n  \n  let scores = {\n    trendStructure: 0,\n    shortTermTrend: 0,\n    volume: 0,\n    rs: 0\n  };\n  \n  // 1. Trend Structure (15 points): Price > 50 SMA > 200 SMA\n  if (indicators.sma50 && indicators.sma200) {\n    if (currentPrice > indicators.sma50 && indicators.sma50 > indicators.sma200) {\n      scores.trendStructure = 15; // Perfect Stage 2 uptrend\n    } else if (currentPrice > indicators.sma200) {\n      scores.trendStructure = 5; // Above 200 SMA but not ideal structure\n    }\n  }\n  \n  // 2. Short-term Trend (10 points): Price > 8 EMA > 21 EMA\n  if (indicators.ema8 && indicators.ema21) {\n    if (currentPrice > indicators.ema8 && indicators.ema8 > indicators.ema21) {\n      scores.shortTermTrend = 10; // Strong short-term momentum\n    } else if (currentPrice > indicators.ema21) {\n      scores.shortTermTrend = 3; // Above 21 EMA\n    }\n  }\n  \n  // 3. Volume (5 points): Recent volume vs 50-day average\n  if (indicators.avgVolume50) {\n    const recentVolume = volumes.slice(-5).reduce((a, b) => a + b, 0) / 5;\n    const volumeRatio = recentVolume / indicators.avgVolume50;\n    \n    if (volumeRatio >= 1.5) {\n      scores.volume = 5; // High volume interest\n    } else if (volumeRatio >= 1.0) {\n      scores.volume = 2; // Normal volume\n    }\n  }\n  \n  // 4. Relative Strength (10 points)\n  const rsData = calculateRelativeStrength(stockData, spyData);\n  if (rsData && rsData.rs52Week) {\n    if (rsData.rs52Week >= 1.5) {\n      scores.rs = 10; // Strong outperformance\n    } else if (rsData.rs52Week >= 1.2) {\n      scores.rs = 7; // Good outperformance\n    } else if (rsData.rs52Week >= 1.0) {\n      scores.rs = 4; // Slight outperformance\n    } else if (rsData.rs52Week >= 0.8) {\n      scores.rs = 1; // Slight underperformance\n    }\n  }\n  \n  const totalScore = scores.trendStructure + scores.shortTermTrend + scores.volume + scores.rs;\n  \n  return {\n    score: totalScore,\n    maxScore: 40,\n    details: {\n      trendStructure: { score: scores.trendStructure, max: 15 },\n      shortTermTrend: { score: scores.shortTermTrend, max: 10 },\n      volume: { score: scores.volume, max: 5 },\n      relativeStrength: { score: scores.rs, max: 10 }\n    },\n    indicators: indicators,\n    rsData: rsData\n  };\n}\n\n/**\n * Calculate Fundamental Score (20 points)\n * ENHANCED with Defeat Beta data (ROE, ROIC, EPS Growth, etc.)\n */\nfunction calculateFundamentalScore(fundamentals) {\n  let scores = {\n    epsGrowth: 0,\n    revenueGrowth: 0,\n    roe: 0,\n    debtToEquity: 0,\n    forwardPe: 0\n  };\n  \n  let dataSource = fundamentals?.enrichedSource || fundamentals?.source || 'unknown';\n  let dataQuality = 'limited';\n  \n  // Check if we have enriched data from Defeat Beta\n  if (fundamentals?.enriched || fundamentals?.source === 'defeatbeta') {\n    dataQuality = 'rich';\n  }\n  \n  // 1. EPS Growth (6 points)\n  // Target: >25% YoY = 6pts, 15-25% = 4pts, 10-15% = 2pts\n  const epsGrowth = fundamentals?.epsGrowth;\n  if (epsGrowth !== null && epsGrowth !== undefined && epsGrowth !== 0) {\n    if (epsGrowth >= 25) {\n      scores.epsGrowth = 6;\n    } else if (epsGrowth >= 15) {\n      scores.epsGrowth = 4;\n    } else if (epsGrowth >= 10) {\n      scores.epsGrowth = 2;\n    } else if (epsGrowth > 0) {\n      scores.epsGrowth = 1;\n    }\n  }\n  \n  // 2. Revenue Growth (5 points)\n  // Target: >20% = 5pts, 10-20% = 3pts, 5-10% = 1pt\n  const revenueGrowth = fundamentals?.revenueGrowth;\n  if (revenueGrowth !== null && revenueGrowth !== undefined && revenueGrowth !== 0) {\n    if (revenueGrowth >= 20) {\n      scores.revenueGrowth = 5;\n    } else if (revenueGrowth >= 10) {\n      scores.revenueGrowth = 3;\n    } else if (revenueGrowth >= 5) {\n      scores.revenueGrowth = 1;\n    }\n  }\n  \n  // 3. ROE (4 points)\n  // Target: >15% = 4pts, 10-15% = 2pts\n  const roe = fundamentals?.roe;\n  if (roe !== null && roe !== undefined && roe !== 0) {\n    if (roe >= 15) {\n      scores.roe = 4;\n    } else if (roe >= 10) {\n      scores.roe = 2;\n    } else if (roe > 0) {\n      scores.roe = 1;\n    }\n  }\n  \n  // 4. Debt/Equity (3 points)\n  // Target: <1.0 = 3pts, 1.0-1.5 = 1pt\n  const debtToEquity = fundamentals?.debtToEquity;\n  if (debtToEquity !== null && debtToEquity !== undefined) {\n    if (debtToEquity < 0.5) {\n      scores.debtToEquity = 3; // Very low debt\n    } else if (debtToEquity < 1.0) {\n      scores.debtToEquity = 2;\n    } else if (debtToEquity < 1.5) {\n      scores.debtToEquity = 1;\n    }\n  }\n  \n  // 5. Forward P/E (2 points)\n  // Target: <20 = 2pts, 20-25 = 1pt (reasonable valuation)\n  const forwardPe = fundamentals?.forwardPe;\n  if (forwardPe !== null && forwardPe !== undefined && forwardPe > 0) {\n    if (forwardPe < 20) {\n      scores.forwardPe = 2;\n    } else if (forwardPe < 25) {\n      scores.forwardPe = 1;\n    }\n  }\n  \n  const totalScore = scores.epsGrowth + scores.revenueGrowth + scores.roe + \n                     scores.debtToEquity + scores.forwardPe;\n  \n  return {\n    score: totalScore,\n    maxScore: 20,\n    details: {\n      epsGrowth: { score: scores.epsGrowth, max: 6, value: epsGrowth },\n      revenueGrowth: { score: scores.revenueGrowth, max: 5, value: revenueGrowth },\n      roe: { score: scores.roe, max: 4, value: roe },\n      debtToEquity: { score: scores.debtToEquity, max: 3, value: debtToEquity },\n      forwardPe: { score: scores.forwardPe, max: 2, value: forwardPe }\n    },\n    dataSource: dataSource,\n    dataQuality: dataQuality\n  };\n}\n\n/**\n * Calculate Sentiment Score (10 points)\n * Placeholder - real sentiment analysis in v2.0\n */\nfunction calculateSentimentScore() {\n  // TODO: Implement real sentiment analysis\n  // For now, return neutral score\n  return {\n    score: 5,\n    maxScore: 10,\n    details: {\n      newsScore: { score: 5, max: 10 }\n    },\n    note: 'Placeholder - real sentiment coming in v2.0'\n  };\n}\n\n/**\n * Calculate Risk/Macro Score (5 points)\n */\nfunction calculateRiskScore(spyData, vixData) {\n  let scores = {\n    vix: 0,\n    spyRegime: 0,\n    breadth: 0\n  };\n  \n  // 1. VIX Level (2 points)\n  const vix = vixData?.current;\n  if (vix !== null && vix !== undefined) {\n    if (vix < 15) {\n      scores.vix = 2; // Low volatility - favorable\n    } else if (vix < 20) {\n      scores.vix = 1; // Normal volatility\n    }\n    // VIX > 20 = 0 points (elevated risk)\n  }\n  \n  // 2. S&P 500 Regime (2 points)\n  if (spyData?.aboveSma200) {\n    scores.spyRegime = 2; // Bullish market regime\n  }\n  \n  // 3. Market Breadth (1 point) - placeholder\n  // Would need % of stocks above 50 SMA\n  scores.breadth = 1; // Default to neutral\n  \n  const totalScore = scores.vix + scores.spyRegime + scores.breadth;\n  \n  return {\n    score: totalScore,\n    maxScore: 5,\n    details: {\n      vix: { score: scores.vix, max: 2, value: vix },\n      spyRegime: { score: scores.spyRegime, max: 2, aboveSma200: spyData?.aboveSma200 },\n      breadth: { score: scores.breadth, max: 1 }\n    }\n  };\n}\n\n/**\n * Check Quality Gates (Auto-AVOID triggers)\n */\nfunction checkQualityGates(stockData, spyData, technicalResult) {\n  const gates = [];\n  const rsData = technicalResult?.rsData;\n  const indicators = technicalResult?.indicators;\n  const prices = stockData.priceHistory.map(d => d.close);\n  const currentPrice = prices[prices.length - 1];\n  \n  // 1. RS below 0.8 (significant underperformance)\n  if (rsData?.rs52Week && rsData.rs52Week < 0.8) {\n    gates.push({\n      name: 'RS Below Threshold',\n      value: rsData.rs52Week.toFixed(2),\n      threshold: '< 0.8',\n      critical: true\n    });\n  }\n  \n  // 2. Stock below 200 SMA (downtrend)\n  if (indicators?.sma200 && currentPrice < indicators.sma200) {\n    gates.push({\n      name: 'Below 200 SMA',\n      value: `$${currentPrice.toFixed(2)}`,\n      threshold: `> $${indicators.sma200.toFixed(2)}`,\n      critical: true\n    });\n  }\n  \n  // 3. Average daily volume < $10M (illiquid)\n  const avgVolume = stockData.avgVolume || 0;\n  const avgDollarVolume = avgVolume * currentPrice;\n  if (avgDollarVolume < 10000000) {\n    gates.push({\n      name: 'Low Liquidity',\n      value: `$${(avgDollarVolume / 1000000).toFixed(1)}M`,\n      threshold: '> $10M',\n      critical: true\n    });\n  }\n  \n  // Count critical failures\n  const criticalFails = gates.filter(g => g.critical).length;\n  \n  return {\n    passed: criticalFails === 0,\n    gates: gates,\n    criticalFails: criticalFails\n  };\n}\n\n/**\n * Determine Verdict based on score and quality gates\n */\nfunction determineVerdict(totalScore, qualityGates, rsData) {\n  // Auto-AVOID conditions\n  if (qualityGates.criticalFails >= 2) {\n    return {\n      verdict: 'AVOID',\n      reason: `${qualityGates.criticalFails} critical failures`,\n      color: 'red'\n    };\n  }\n  \n  if (rsData?.rs52Week && rsData.rs52Week < 0.8) {\n    return {\n      verdict: 'AVOID',\n      reason: 'RS significantly below market',\n      color: 'red'\n    };\n  }\n  \n  // Score-based verdict\n  if (totalScore >= 60 && qualityGates.criticalFails === 0) {\n    // Additional check: RS must be >= 1.0 for BUY\n    if (rsData?.rs52Week && rsData.rs52Week >= 1.0) {\n      return {\n        verdict: 'BUY',\n        reason: `Strong score (${totalScore}/75) with good RS`,\n        color: 'green'\n      };\n    } else {\n      return {\n        verdict: 'HOLD',\n        reason: 'Good score but RS below 1.0',\n        color: 'yellow'\n      };\n    }\n  }\n  \n  if (totalScore >= 40) {\n    return {\n      verdict: 'HOLD',\n      reason: `Moderate score (${totalScore}/75)`,\n      color: 'yellow'\n    };\n  }\n  \n  return {\n    verdict: 'AVOID',\n    reason: `Low score (${totalScore}/75)`,\n    color: 'red'\n  };\n}\n\n/**\n * Main scoring function\n * Calculates complete analysis for a stock\n * \n * v2.1: Returns a clean, consumer-facing API structure\n */\nexport function calculateScore(stockData, spyData, vixData) {\n  // Calculate individual scores\n  const technicalAnalysis = calculateTechnicalScore(stockData, spyData);\n  const fundamentalAnalysis = calculateFundamentalScore(stockData.fundamentals);\n  const sentimentAnalysis = calculateSentimentScore();\n  const riskAnalysis = calculateRiskScore(spyData, vixData);\n  \n  // Total score\n  const totalScore = technicalAnalysis.score + fundamentalAnalysis.score + \n                     sentimentAnalysis.score + riskAnalysis.score;\n  \n  // Quality gates\n  const qualityGates = checkQualityGates(stockData, spyData, technicalAnalysis);\n  \n  // Verdict\n  const verdict = determineVerdict(totalScore, qualityGates, technicalAnalysis.rsData);\n  \n  // Get RS data for clean API\n  const rsData = technicalAnalysis.rsData || {};\n  \n  // Calculate % from 52-week high\n  const fiftyTwoWeekHigh = stockData.fiftyTwoWeekHigh;\n  const fiftyTwoWeekLow = stockData.fiftyTwoWeekLow;\n  const currentPrice = stockData.currentPrice;\n  const pctFromHigh = fiftyTwoWeekHigh ? \n    ((currentPrice - fiftyTwoWeekHigh) / fiftyTwoWeekHigh) * 100 : null;\n  \n  // Debug logging\n  console.log('=== SCORING ENGINE DEBUG ===');\n  console.log('Stock:', stockData.ticker);\n  console.log('Technical Score:', technicalAnalysis.score, '/', technicalAnalysis.maxScore);\n  console.log('Technical Details:', technicalAnalysis.details);\n  console.log('Fundamental Score:', fundamentalAnalysis.score, '/', fundamentalAnalysis.maxScore);\n  console.log('Fundamental Details:', fundamentalAnalysis.details);\n  console.log('Fundamental Data Source:', fundamentalAnalysis.dataSource);\n  console.log('Fundamental Data Quality:', fundamentalAnalysis.dataQuality);\n  console.log('Sentiment Score:', sentimentAnalysis.score, '/', sentimentAnalysis.maxScore);\n  console.log('Risk Score:', riskAnalysis.score, '/', riskAnalysis.maxScore);\n  console.log('Total Score:', totalScore, '/ 75');\n  console.log('Quality Gates:', qualityGates);\n  console.log('Verdict:', verdict);\n  console.log('============================');\n  \n  // =========================================================\n  // CLEAN API RETURN STRUCTURE (v2.1)\n  // UI can consume this directly without knowing internals\n  // =========================================================\n  return {\n    // Basic info\n    ticker: stockData.ticker,\n    name: stockData.name,\n    sector: stockData.sector,\n    industry: stockData.industry,\n    \n    // Price data (for UI display)\n    currentPrice: currentPrice,\n    fiftyTwoWeekHigh: fiftyTwoWeekHigh,\n    fiftyTwoWeekLow: fiftyTwoWeekLow,\n    pctFromHigh: pctFromHigh,\n    \n    // Scores - FLAT structure for easy UI consumption\n    totalScore: totalScore,\n    maxScore: 75,\n    scores: {\n      technical: technicalAnalysis.score,\n      fundamental: fundamentalAnalysis.score,\n      sentiment: sentimentAnalysis.score,\n      risk: riskAnalysis.score\n    },\n    \n    // Verdict\n    verdict: verdict,\n    qualityGates: qualityGates,\n    \n    // RS Data - Normalized field names for UI\n    rsData: {\n      rsRatio: rsData.rs52Week,              // UI expects rsRatio\n      rs52Week: rsData.rs52Week,\n      rs13Week: rsData.rs13Week,\n      rsRating: rsData.rsRating,\n      rsTrend: rsData.rsTrend,\n      stock52wReturn: rsData.stockReturn52w,  // UI expects stock52wReturn\n      spy52wReturn: rsData.spyReturn52w,      // UI expects spy52wReturn\n      interpretation: rsData.interpretation,\n      passesQualityGate: rsData.passesQualityGate\n    },\n    \n    // Technical indicators\n    indicators: technicalAnalysis.indicators,\n    \n    // Detailed breakdown (for debugging/advanced UI)\n    breakdown: {\n      technical: technicalAnalysis,\n      fundamental: fundamentalAnalysis,\n      sentiment: sentimentAnalysis,\n      risk: riskAnalysis\n    },\n    \n    // Metadata\n    timestamp: new Date().toISOString()\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}