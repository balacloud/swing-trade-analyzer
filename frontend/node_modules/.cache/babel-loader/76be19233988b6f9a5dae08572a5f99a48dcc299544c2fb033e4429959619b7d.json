{"ast":null,"code":"/**\n * API Service Layer\n * Connects React frontend to Flask backend (port 5001)\n * \n * IMPORTANT: This transforms the backend response format to match\n * what the frontend scoring engine expects.\n */\n\nconst API_BASE = 'http://localhost:5001/api';\n\n/**\n * Fetch stock data from backend and transform to expected format\n * @param {string} ticker - Stock symbol (e.g., 'AAPL')\n * @returns {Promise<Object>} Stock data with prices, fundamentals, etc.\n */\nexport async function fetchStockData(ticker) {\n  try {\n    const response = await fetch(`${API_BASE}/stock/${ticker.toUpperCase()}`);\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || `Failed to fetch ${ticker}`);\n    }\n    const data = await response.json();\n\n    // Transform backend response to frontend expected format\n    return transformStockData(data);\n  } catch (error) {\n    console.error(`Error fetching stock data for ${ticker}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Transform backend stock data to frontend format\n * \n * Backend returns:\n *   - priceHistory: array of closing prices\n *   - highs: array at top level\n *   - lows: array at top level\n *   - volumes: array at top level\n * \n * Frontend expects:\n *   - priceHistory: { closes: [], highs: [], lows: [], volumes: [] }\n *   - price52WeeksAgo, price13WeeksAgo for RS calculation\n */\nfunction transformStockData(data) {\n  const closes = data.priceHistory || [];\n  const highs = data.highs || [];\n  const lows = data.lows || [];\n  const volumes = data.volumes || [];\n\n  // Calculate prices from N weeks ago for RS calculation\n  // We have ~200 data points, need to find 52 weeks (~252 trading days) and 13 weeks (~65 days)\n  // Since we only have 200 points, use what we have\n  const price52WeeksAgo = closes.length >= 200 ? closes[0] // Oldest price (approximately 52 weeks ago with 200 data points)\n  : closes[0];\n  const price13WeeksAgo = closes.length >= 65 ? closes[closes.length - 65] : closes[Math.floor(closes.length * 0.25)]; // ~25% from end\n\n  return {\n    ticker: data.ticker,\n    currentPrice: data.currentPrice,\n    avgVolume: data.avgVolume,\n    dataPoints: data.dataPoints,\n    dataSource: data.dataSource,\n    lastUpdated: data.lastUpdated,\n    // Prices for RS calculation\n    price52WeeksAgo: price52WeeksAgo,\n    price13WeeksAgo: price13WeeksAgo,\n    // Price history in the format the scoring engine expects\n    priceHistory: {\n      closes: closes,\n      highs: highs,\n      lows: lows,\n      volumes: volumes,\n      dates: data.dates || []\n    },\n    // Fundamentals (pass through as-is)\n    fundamentals: data.fundamentals || {}\n  };\n}\n\n/**\n * Fetch SPY (S&P 500) data for Relative Strength calculation\n * @returns {Promise<Object>} SPY data with current price and historical prices\n */\nexport async function fetchSPYData() {\n  try {\n    const response = await fetch(`${API_BASE}/market/spy`);\n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Failed to fetch SPY data');\n    }\n    const data = await response.json();\n\n    // Transform SPY data to match expected format\n    return transformSPYData(data);\n  } catch (error) {\n    console.error('Error fetching SPY data:', error);\n    throw error;\n  }\n}\n\n/**\n * Transform SPY data to frontend format\n * \n * Backend returns: price52wAgo, price13wAgo (lowercase 'w')\n * Frontend expects: price52WeeksAgo, price13WeeksAgo (camelCase)\n */\nfunction transformSPYData(data) {\n  return {\n    ticker: 'SPY',\n    currentPrice: data.currentPrice,\n    // Map backend field names to frontend expected names\n    price52WeeksAgo: data.price52wAgo,\n    // Backend uses 'price52wAgo'\n    price13WeeksAgo: data.price13wAgo,\n    // Backend uses 'price13wAgo'\n    sma200: data.sma200 || null,\n    priceHistory: data.priceHistory || [],\n    lastUpdated: data.lastUpdated\n  };\n}\n\n/**\n * Check if backend is healthy\n * @returns {Promise<boolean>} True if backend is running\n */\nexport async function checkHealth() {\n  try {\n    const response = await fetch(`${API_BASE}/health`);\n    return response.ok;\n  } catch (error) {\n    console.error('Backend health check failed:', error);\n    return false;\n  }\n}\n\n/**\n * Fetch both stock and SPY data in parallel\n * @param {string} ticker - Stock symbol\n * @returns {Promise<Object>} Combined stock and SPY data\n */\nexport async function fetchAnalysisData(ticker) {\n  try {\n    var _stockData$priceHisto, _stockData$priceHisto2;\n    const [stockData, spyData] = await Promise.all([fetchStockData(ticker), fetchSPYData()]);\n    console.log('Stock data transformed:', {\n      ticker: stockData.ticker,\n      currentPrice: stockData.currentPrice,\n      price52WeeksAgo: stockData.price52WeeksAgo,\n      closesLength: (_stockData$priceHisto = stockData.priceHistory) === null || _stockData$priceHisto === void 0 ? void 0 : (_stockData$priceHisto2 = _stockData$priceHisto.closes) === null || _stockData$priceHisto2 === void 0 ? void 0 : _stockData$priceHisto2.length,\n      hasFundamentals: !!stockData.fundamentals\n    });\n    console.log('SPY data:', {\n      currentPrice: spyData.currentPrice,\n      price52WeeksAgo: spyData.price52WeeksAgo\n    });\n    return {\n      stock: stockData,\n      spy: spyData,\n      fetchedAt: new Date().toISOString()\n    };\n  } catch (error) {\n    console.error('Error fetching analysis data:', error);\n    throw error;\n  }\n}","map":{"version":3,"names":["API_BASE","fetchStockData","ticker","response","fetch","toUpperCase","ok","errorData","json","Error","error","data","transformStockData","console","closes","priceHistory","highs","lows","volumes","price52WeeksAgo","length","price13WeeksAgo","Math","floor","currentPrice","avgVolume","dataPoints","dataSource","lastUpdated","dates","fundamentals","fetchSPYData","transformSPYData","price52wAgo","price13wAgo","sma200","checkHealth","fetchAnalysisData","_stockData$priceHisto","_stockData$priceHisto2","stockData","spyData","Promise","all","log","closesLength","hasFundamentals","stock","spy","fetchedAt","Date","toISOString"],"sources":["/Users/balajik/projects/swing-trade-analyzer/frontend/src/services/api.js"],"sourcesContent":["/**\n * API Service Layer\n * Connects React frontend to Flask backend (port 5001)\n * \n * IMPORTANT: This transforms the backend response format to match\n * what the frontend scoring engine expects.\n */\n\nconst API_BASE = 'http://localhost:5001/api';\n\n/**\n * Fetch stock data from backend and transform to expected format\n * @param {string} ticker - Stock symbol (e.g., 'AAPL')\n * @returns {Promise<Object>} Stock data with prices, fundamentals, etc.\n */\nexport async function fetchStockData(ticker) {\n  try {\n    const response = await fetch(`${API_BASE}/stock/${ticker.toUpperCase()}`);\n    \n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || `Failed to fetch ${ticker}`);\n    }\n    \n    const data = await response.json();\n    \n    // Transform backend response to frontend expected format\n    return transformStockData(data);\n  } catch (error) {\n    console.error(`Error fetching stock data for ${ticker}:`, error);\n    throw error;\n  }\n}\n\n/**\n * Transform backend stock data to frontend format\n * \n * Backend returns:\n *   - priceHistory: array of closing prices\n *   - highs: array at top level\n *   - lows: array at top level\n *   - volumes: array at top level\n * \n * Frontend expects:\n *   - priceHistory: { closes: [], highs: [], lows: [], volumes: [] }\n *   - price52WeeksAgo, price13WeeksAgo for RS calculation\n */\nfunction transformStockData(data) {\n  const closes = data.priceHistory || [];\n  const highs = data.highs || [];\n  const lows = data.lows || [];\n  const volumes = data.volumes || [];\n  \n  // Calculate prices from N weeks ago for RS calculation\n  // We have ~200 data points, need to find 52 weeks (~252 trading days) and 13 weeks (~65 days)\n  // Since we only have 200 points, use what we have\n  const price52WeeksAgo = closes.length >= 200 \n    ? closes[0]  // Oldest price (approximately 52 weeks ago with 200 data points)\n    : closes[0];\n    \n  const price13WeeksAgo = closes.length >= 65 \n    ? closes[closes.length - 65] \n    : closes[Math.floor(closes.length * 0.25)]; // ~25% from end\n  \n  return {\n    ticker: data.ticker,\n    currentPrice: data.currentPrice,\n    avgVolume: data.avgVolume,\n    dataPoints: data.dataPoints,\n    dataSource: data.dataSource,\n    lastUpdated: data.lastUpdated,\n    \n    // Prices for RS calculation\n    price52WeeksAgo: price52WeeksAgo,\n    price13WeeksAgo: price13WeeksAgo,\n    \n    // Price history in the format the scoring engine expects\n    priceHistory: {\n      closes: closes,\n      highs: highs,\n      lows: lows,\n      volumes: volumes,\n      dates: data.dates || []\n    },\n    \n    // Fundamentals (pass through as-is)\n    fundamentals: data.fundamentals || {}\n  };\n}\n\n/**\n * Fetch SPY (S&P 500) data for Relative Strength calculation\n * @returns {Promise<Object>} SPY data with current price and historical prices\n */\nexport async function fetchSPYData() {\n  try {\n    const response = await fetch(`${API_BASE}/market/spy`);\n    \n    if (!response.ok) {\n      const errorData = await response.json();\n      throw new Error(errorData.error || 'Failed to fetch SPY data');\n    }\n    \n    const data = await response.json();\n    \n    // Transform SPY data to match expected format\n    return transformSPYData(data);\n  } catch (error) {\n    console.error('Error fetching SPY data:', error);\n    throw error;\n  }\n}\n\n/**\n * Transform SPY data to frontend format\n * \n * Backend returns: price52wAgo, price13wAgo (lowercase 'w')\n * Frontend expects: price52WeeksAgo, price13WeeksAgo (camelCase)\n */\nfunction transformSPYData(data) {\n  return {\n    ticker: 'SPY',\n    currentPrice: data.currentPrice,\n    // Map backend field names to frontend expected names\n    price52WeeksAgo: data.price52wAgo,   // Backend uses 'price52wAgo'\n    price13WeeksAgo: data.price13wAgo,   // Backend uses 'price13wAgo'\n    sma200: data.sma200 || null,\n    priceHistory: data.priceHistory || [],\n    lastUpdated: data.lastUpdated\n  };\n}\n\n/**\n * Check if backend is healthy\n * @returns {Promise<boolean>} True if backend is running\n */\nexport async function checkHealth() {\n  try {\n    const response = await fetch(`${API_BASE}/health`);\n    return response.ok;\n  } catch (error) {\n    console.error('Backend health check failed:', error);\n    return false;\n  }\n}\n\n/**\n * Fetch both stock and SPY data in parallel\n * @param {string} ticker - Stock symbol\n * @returns {Promise<Object>} Combined stock and SPY data\n */\nexport async function fetchAnalysisData(ticker) {\n  try {\n    const [stockData, spyData] = await Promise.all([\n      fetchStockData(ticker),\n      fetchSPYData()\n    ]);\n    \n    console.log('Stock data transformed:', {\n      ticker: stockData.ticker,\n      currentPrice: stockData.currentPrice,\n      price52WeeksAgo: stockData.price52WeeksAgo,\n      closesLength: stockData.priceHistory?.closes?.length,\n      hasFundamentals: !!stockData.fundamentals\n    });\n    \n    console.log('SPY data:', {\n      currentPrice: spyData.currentPrice,\n      price52WeeksAgo: spyData.price52WeeksAgo\n    });\n    \n    return {\n      stock: stockData,\n      spy: spyData,\n      fetchedAt: new Date().toISOString()\n    };\n  } catch (error) {\n    console.error('Error fetching analysis data:', error);\n    throw error;\n  }\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}